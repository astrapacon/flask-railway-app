{% extends "base.html" %}
{% block title %}Resultado da Presença{% endblock %}

{% block content %}

<style>
    /* Estilos e Keyframes para Animações */
    .animation-container {
        display: flex; gap: 30px; justify-content: center; margin-bottom: 20px;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
    }
    /* GLOBO e AVIÃO (Adaptação para cor Bordo) */
    .globe{width:80px;height:80px; position:relative; overflow:hidden;}
    .earth{fill:#3a3536}.earth-land{fill:var(--ok); opacity:.9}
    .plane{width:22px;height:22px; position:absolute; top:50%; left:50%; transform-origin:-30px -30px;}
    .orbit{ animation: orbit 6s linear infinite; }
    @keyframes orbit { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* ESTRADA e CARRO (Adaptação para cor Bordo) */
    .road{width:160px;height:50px; background:linear-gradient(#1b1b1b,#0f0f0f); border-radius:6px; position:relative; overflow:hidden; border:1px solid var(--line)}
    .lane{position:absolute; left:0; right:0; height:2px; top:50%; background:repeating-linear-gradient(90deg, transparent 0 16px, #f4f4f4 16px 32px); opacity:.7}
    .car{position:absolute; bottom:6px; left:-80px; width:70px; height:28px; background:var(--ok); border:1px solid #501010; border-radius:5px;}
    .car:before{content:""; position:absolute; left:5px; top:-8px; width:30px; height:18px; background:#9a2a2d; border:1px solid #501010; border-radius:5px}
    .wheel{position:absolute; bottom:-6px; width:16px; height:16px; border-radius:50%; background:radial-gradient(circle at 50% 50%, #444 0 45%, #111 46% 100%); border:1px solid #000}
    .w1{left:8px}.w2{right:10px}
    .drive{ animation: drive 2.2s ease-in-out infinite; }
    .spin{ animation: spin .7s linear infinite; }
    @keyframes drive { 0% { transform: translateX(0); } 60% { transform: translateX(200px); } 100% { transform: translateX(260px); } }
    @keyframes spin { from { transform: rotate(0); } to { transform: rotate(360deg); } }
</style>

{% if ok %}
  {% if already %}
    <div class="pill warn">ℹ️ Presença já registrada</div>
    <h1>Presença já confirmada hoje</h1>
    <p class="muted">Matrícula <b class="mono">{{ code }}</b>{% if name %} — {{ name }}{% endif %}.
    Registro anterior em <span class="mono">{{ when }}</span>.</p>
  {% else %}
    <div class="pill ok">✅ Presença confirmada</div>
    <h1>Presença registrada com sucesso</h1>
    
    <div class="animation-container">
        <div class="globe">
            <svg viewBox="0 0 200 200" width="80" height="80"><circle cx="100" cy="100" r="70" class="earth"/><path d="M110,70 C130,90 130,110 110,130 C90,110 70,110 70,100 C70,90 90,70 110,70Z" class="earth-land"/></svg>
            <div class="plane orbit"><svg viewBox="0 0 64 64" width="22" height="22"><path d="M4 30 L40 30 L60 20 L62 24 L46 32 L60 40 L58 44 L40 34 L4 34 Z" fill="#f4f4f4"/></svg></div>
        </div>
        
        <div class="road">
            <div class="lane" style="animation: dash 1s linear infinite;"></div>
            <style>@keyframes dash { from{ transform: translateX(0); } to{ transform: translateX(-32px);} }</style>
            <div class="car drive">
                <div class="wheel w1 spin"></div>
                <div class="wheel w2 spin"></div>
            </div>
        </div>
    </div>
        <p class="muted">Matrícula <b class="mono">{{ code }}</b>{% if name %} — {{ name }}{% endif %}.
    Data: <span class="mono">{{ date }}</span>.</p>
  {% endif %}
  <div class="mt"><a class="btn" href="/presenca">Nova presença</a></div>
{% else %}
  <div class="pill err">❌ Erro</div>
  <h1>{{ title }}</h1>
  <p class="muted">{{ msg }}</p>
  <div class="mt"><a class="btn" href="/presenca">Tentar novamente</a></div>
{% endif %}
{% endblock %}